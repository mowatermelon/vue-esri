// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.6/esri/copyright.txt for details.
//>>built
define("require exports ../../lib/glMatrix ../../support/projectionUtils ../../support/aaBoundingBox ../../support/orientedBoundingBox".split(" "),function(v,w,n,u,r,t){var q=n.vec3d.create();return function(){function c(a,b,d){this._pages=[];this.pageSize=0;this._renderSR=this._nodeSR=null;this._nodeSR=a;this._renderSR=b;this.pageSize=d}c.prototype.addPage=function(a,b,d){for(void 0===d&&(d=0);this._pages.length<a;)this._pages.push(null);for(var c=this._nodeSR,g=this._renderSR,m=new t.ObbArray(b.length),
e=0;e<b.length;e++){var h=b[e].obb,k=m.obbs[e];n.vec3.set3(h.center[0],h.center[1],h.center[2]+d,q);u.bufferToBuffer(q,c,0,k.center,g,0,1);n.vec3.set(h.halfSize,k.halfSize);n.quat4.set(h.quaternion,k.quaternion)}this._pages[a]={nodes:b,renderObbs:m.obbs,parents:new Uint32Array(this.pageSize)};a=this._pages;b=this.pageSize;for(c=[0];c.length;)for(g=c.pop(),d=a[g/b|0].nodes[g%b],m=0;m<d.childCount;m++)e=d.firstChild+m,null!=a[e/b|0]&&(a[e/b|0].parents[e%b]=g,c.push(e))};c.prototype.hasPage=function(a){return!!this._pages[a]};
c.prototype.getNode=function(a){var b=this.pageSize;return this._pages[a/b|0].nodes[a%b]};c.prototype.getRenderObb=function(a){var b=this.pageSize;return this._pages[a/b|0].renderObbs[a%b]};c.prototype.getRenderCenter=function(a){return this.getRenderObb(a).center};c.prototype.getParentId=function(a){var b=this.pageSize;return this._pages[a/b|0].parents[a%b]};c.prototype.hasNodes=function(a,b){b=(a+b-1)/this.pageSize|0;for(a=a/this.pageSize|0;a<=b;a++)if(null==this._pages[a])return!1;return!0};c.prototype.createVisibilityTraverse=
function(){var a=this,b=[],c=[],n=r.create();return function(g,m){if(a.hasNodes(0,1))for(b.length=0,b.push(0),c.length=0,c.push(0);0<b.length;){var e=b.pop(),h=c.pop(),k=a.getNode(e),d=a.getRenderObb(e),p=!0;if(null!=g.clippingBox){var l=1<<g.frustumPlanes.length;if(0===(h&l)){var f=t.toAaBoundingBox(d,n);r.contains(g.clippingBox,f)?h|=l:r.intersects(g.clippingBox,f)||(p=!1)}}for(f=0;f<g.frustumPlanes.length&&p;f++)if(l=1<<f,0===(h&l)){var q=t.intersectPlane(d,g.frustumPlanes[f]);0<q?p=!1:0>q&&(h|=
l)}if(m.predicate(e,k,p)){d=k.firstChild;k=k.childCount;f=!1;p=(d+k-1)/a.pageSize|0;for(l=d/a.pageSize|0;l<=p;l++)if(!a.hasPage(l)){m.pageMiss(e,l);f=!0;break}if(!f)for(f=0;f<k;f++)b.push(d+f),c.push(h)}}}};return c}()});