// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.6/esri/copyright.txt for details.
//>>built
define(["require","exports","./I3SBinaryReader","../../../../renderers/PointCloudRenderer"],function(w,m,u,v){function q(a){return(a=a&&a.pointSizeAlgorithm)&&"splat"===a.type?a:null}function r(a,c){for(var g=0;g<a.length;g++){var b=a[g];if(b.name===c&&null!=b.attributeValues&&"UInt8"===b.attributeValues.valueType&&3===b.attributeValues.valuesPerElement)return{storageInfo:b,useElevation:!1}}return null}function n(a,c){for(var g=0;g<a.length;g++){var b=a[g];if(b.name===c)return a="embedded-elevation"===
b.encoding,{storageInfo:a?null:b,useElevation:a}}return"elevation"===c.toLowerCase()?{storageInfo:null,useElevation:!0}:null}function t(a,c,g,b){if(a&&a.useElevation){a=new Float64Array(b);for(c=0;c<b;c++)a[c]=g[3*c+2];return a}return a&&c?u.readBinaryAttribute(a.storageInfo,c,b):null}function p(a){return null==a||"none"===a?null:"low-four-bit"===a?function(a){return a&15}:"high-four-bit"===a?function(a){return(a&240)>>4}:"absolute-value"===a?function(a){return Math.abs(a)}:"modulo-ten"===a?function(a){return a%
10}:null}Object.defineProperty(m,"__esModule",{value:!0});m.getRendererInfo=function(a){var c=a.renderer,g=c&&c.type,b=null,l=!1;"point-cloud-unique-value"===g?b=n(a.attributeStorageInfo,c.field):"point-cloud-stretch"===g?b=n(a.attributeStorageInfo,c.field):"point-cloud-class-breaks"===g?b=n(a.attributeStorageInfo,c.field):(b="point-cloud-rgb"===g?r(a.attributeStorageInfo,c.field):r(a.attributeStorageInfo,"RGB"),l=null!=b);g=null;c&&c.colorModulation&&(g=n(a.attributeStorageInfo,c.colorModulation.field));
return{renderer:c,isRGBRenderer:l,primaryAttribute:b,modulationAttribute:g}};m.evaluateRenderer=function(a,c,g,b,l){var h=a.renderer,d=a.isRGBRenderer,k=a.modulationAttribute;a=t(a.primaryAttribute,c,b,l);g=t(k,g,b,l);b=null;if(a&&d)b=a;else if(a&&h&&"point-cloud-unique-value"===h.type){var e=h.colorUniqueValueInfos;b=new Uint8Array(3*l);k=p(h.fieldTransformType);for(d=0;d<l;d++){c=k?k(a[d]):a[d];c+="";for(var f=0;f<e.length;f++)if(0<=e[f].values.indexOf(c)){b[3*d]=e[f].color.r;b[3*d+1]=e[f].color.g;
b[3*d+2]=e[f].color.b;break}}}else if(a&&h&&"point-cloud-stretch"===h.type)for(e=h.stops,b=new Uint8Array(3*l),k=p(h.fieldTransformType),d=0;d<l;d++)if(c=k?k(a[d]):a[d],f=e.length-1,c<e[0].value)b[3*d]=e[0].color.r,b[3*d+1]=e[0].color.g,b[3*d+2]=e[0].color.b;else if(c>=e[f].value)b[3*d]=e[f].color.r,b[3*d+1]=e[f].color.g,b[3*d+2]=e[f].color.b;else for(f=1;f<e.length;f++){if(c<e[f].value){c=(c-e[f-1].value)/(e[f].value-e[f-1].value);b[3*d]=e[f].color.r*c+e[f-1].color.r*(1-c);b[3*d+1]=e[f].color.g*
c+e[f-1].color.g*(1-c);b[3*d+2]=e[f].color.b*c+e[f-1].color.b*(1-c);break}}else if(a&&h&&"point-cloud-class-breaks"===h.type)for(e=h.colorClassBreakInfos,b=new Uint8Array(3*l),k=p(h.fieldTransformType),d=0;d<l;d++)for(c=k?k(a[d]):a[d],f=0;f<e.length;f++){if(c>=e[f].minValue&&c<=e[f].maxValue){b[3*d]=e[f].color.r;b[3*d+1]=e[f].color.g;b[3*d+2]=e[f].color.b;break}}else for(b=new Uint8Array(3*l),d=0;d<b.length;d++)b[d]=255;if(g&&h&&h.colorModulation)for(a=h.colorModulation.minValue,h=h.colorModulation.maxValue,
d=0;d<l;d++)c=g[d],k=c>=h?1:c<=a?.3:.3+.7*(c-a)/(h-a),b[3*d]*=k,b[3*d+1]*=k,b[3*d+2]*=k;return b};m.getSplatSizeAlgorithm=q;m.getMinSize=function(a){return(a=q(a))&&null!=a.minSize?a.minSize:v.defaultMinSize};m.getFixedSizeAlgorithm=function(a){return(a=a&&a.pointSizeAlgorithm)&&"fixed-size"===a.type?a:null};m.rendererUsesFixedSizes=function(a){return(a=a&&a.pointSizeAlgorithm)&&a.type?"fixed-size"===a.type:!1}});