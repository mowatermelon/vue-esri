// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.6/esri/copyright.txt for details.
//>>built
define("require exports dojo/has ../../core/promiseUtils ../../core/requireUtils ../PortalItem ./portalLayers ../../layers/Layer ../../renderers/support/styleUtils ./mapNotesUtils".split(" "),function(q,f,G,h,r,t,u,v,w,x){function y(a,b,c){var g,e;return r.when(q,"../../layers/"+b).then(function(b){var d={};a.itemId&&(d.portalItem={id:a.itemId,portal:c.context.portal});e=g=new b(d);e.read(a,c.context);return w.loadStyleRenderer(e,c.context).then(function(){return h.resolve(g)})})}function l(a,b){return z(a,
b).then(function(c){return y(a,c,b)})}function z(a,b){var c=b.context,g=A(c),e=a.layerType||a.type;!e&&b&&b.defaultLayerType&&(e=b.defaultLayerType);b=g[e]||"UnknownLayer";if("Feature Collection"===a.type){if(a.itemId)return(new t({id:a.itemId,portal:c&&c.portal})).load().then(u.selectLayerClassPath).then(function(a){return a.className})}else"ArcGISFeatureLayer"===e&&x.isMapNotesLayer(a)&&(b="MapNotesLayer");a.wmtsInfo&&(b="WMTSLayer");return h.resolve(b)}function A(a){switch(a.origin){case "web-scene":switch(a.layerContainerType){case "basemap":a=
B;break;case "ground":a=C;break;default:a=D}break;default:switch(a.layerContainerType){case "basemap":a=E;break;default:a=F}}return a}function m(a,b,c){return b&&b.filter?c.then(function(a){var c=b.filter(a);return void 0===c?h.resolve(a):c instanceof v?h.resolve(c):c}):c}function k(a,b,c){if(!b)return[];for(var g=[],e=[],f=0;f<b.length;f++){var d=b[f],k=l(d,c);g.push(k);e.push(null);if("GroupLayer"===d.layerType&&d.layers&&Array.isArray(d.layers)&&0<d.layers.length){d=d.layers.map(function(a){return l(a,
c)});g.push.apply(g,d);for(var n=0;n<d.length;n++)e.push(k)}}var p={};return g.map(function(b,d){var f=function(a,b){p[b.id]=d;var c=a.findIndex(function(a){if(!a.id)return!1;a=p[a.id];return void 0===a?!1:d<a});0>c&&(c=void 0);a.add(b,c)};return m(a,c,b).then(function(b){if(null===e[d])f(a,b);else return e[d].then(function(a){f(a.layers,b);return h.resolve(b)});return h.resolve(b)})})}Object.defineProperty(f,"__esModule",{value:!0});var D={ArcGISFeatureLayer:"FeatureLayer",ArcGISImageServiceLayer:"ImageryLayer",
ArcGISMapServiceLayer:"MapImageLayer",PointCloudLayer:"PointCloudLayer",ArcGISSceneServiceLayer:"SceneLayer",IntegratedMeshLayer:"IntegratedMeshLayer",ArcGISTiledElevationServiceLayer:"ElevationLayer",ArcGISTiledImageServiceLayer:"TileLayer",ArcGISTiledMapServiceLayer:"TileLayer",GroupLayer:"GroupLayer",WebTiledLayer:"WebTileLayer",CSV:"CSVLayer",VectorTileLayer:"VectorTileLayer",WMS:"WMSLayer",DefaultTileLayer:"TileLayer"},C={ArcGISTiledElevationServiceLayer:"ElevationLayer",DefaultTileLayer:"ElevationLayer"},
B={ArcGISTiledMapServiceLayer:"TileLayer",ArcGISTiledImageServiceLayer:"TileLayer",OpenStreetMap:"OpenStreetMapLayer",WebTiledLayer:"WebTileLayer",VectorTileLayer:"VectorTileLayer",ArcGISImageServiceLayer:"UnsupportedLayer",WMS:"UnsupportedLayer",ArcGISMapServiceLayer:"UnsupportedLayer",DefaultTileLayer:"TileLayer"},F={ArcGISFeatureLayer:"FeatureLayer",ArcGISImageServiceLayer:"ImageryLayer",ArcGISImageServiceVectorLayer:"UnsupportedLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISStreamLayer:"StreamLayer",
ArcGISTiledImageServiceLayer:"TileLayer",ArcGISTiledMapServiceLayer:"TileLayer",VectorTileLayer:"VectorTileLayer",WebTiledLayer:"WebTileLayer",CSV:"CSVLayer",GeoRSS:"GeoRSSLayer",KML:"KMLLayer",WMS:"WMSLayer",DefaultTileLayer:"TileLayer"},E={ArcGISImageServiceLayer:"ImageryLayer",ArcGISImageServiceVectorLayer:"UnsupportedLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISTiledImageServiceLayer:"TileLayer",ArcGISTiledMapServiceLayer:"TileLayer",OpenStreetMap:"OpenStreetMapLayer",VectorTileLayer:"VectorTileLayer",
WebTiledLayer:"WebTileLayer",bingLayer:"UnsupportedLayer",WMS:"WMSLayer",DefaultTileLayer:"TileLayer"};f.createLayer=l;f.processLayer=m;f.populateLayers=k;f.populateOperationalLayers=function(a,b,c){return k(a,b,c)}});