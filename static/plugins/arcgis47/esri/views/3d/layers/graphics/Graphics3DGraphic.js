// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.7/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/asyncUtils ../../../../core/ObjectPool ./featureExpressionInfoUtils ../../support/aaBoundingBox ../../support/aaBoundingRect".split(" "),function(w,x,g,m,r,t,u,f,n){var p=new t(Array,function(b){return f.set(b,f.ZERO)},null,10,5),v=n.create();return function(){function b(a,e,c){this.addedToSpatialIndex=!1;this._labelGraphics=[];this._auxiliaryGraphics=[];for(var d=Array(2),
b=0;b<d.length;b++)d[b]=Array(3);this._visibilityFlags=d;this._featureExpressionFeature=null;this.graphics3DSymbol=e;this.graphic=a;this._graphics=c;this._featureExpressionFeature=u.createFeature(a)}b.prototype.initialize=function(a,e){var c=this;this._layer=a;this._stage=e;this.forEachSymbolLayerGraphic(function(d){d.initialize(a,e);d.setVisibility(c.isVisible())})};b.prototype.destroy=function(){this.forEachRenderedGraphic(function(a){return a.destroy()});this._graphics.length=0;this._labelGraphics.length=
0;this._auxiliaryGraphics.length=0};b.prototype.clearLabelGraphics=function(){this.forEachLabelGraphic(function(a){return a.destroy()});this._labelGraphics.length=0};b.prototype.addLabelGraphic=function(a,e,c){this._labelGraphics.push(a);a.initialize(e,c);a.setVisibility(this.isVisible(1))};b.prototype.addAuxiliaryGraphic=function(a){this._auxiliaryGraphics.push(a);this._layer&&(a.initialize(this._layer,this._stage),a.setVisibility(this.isVisible()))};b.prototype.isDraped=function(){var a=!1;this.forEachSymbolLayerGraphic(function(e){e.isDraped()&&
(a=!0)});return a};b.prototype.setDrawOrder=function(a,e,c){var d=this;c[this.graphics3DSymbol.symbol.id]=!0;this.forEachSymbolLayerGraphic(function(b,f){b.setDrawOrder(a+(1-(1+f)/d._graphics.length),e,c)})};b.prototype.areVisibilityFlagsSet=function(a,e,c){void 0===c&&(c=0);c=this._visibilityFlags[c];if(null!=a)return c[a];a=!0;for(var d=0;d<c.length;d++)if(d!==e){var b=c[d];a=a&&(null==b||!0===b)}return a};b.prototype.isVisible=function(a){void 0===a&&(a=0);for(var e=!0,c=0;c<=a;c++)for(var d=this._visibilityFlags[c],
b=0;b<d.length;b++)var f=d[b],e=e&&(null==f||!0===f);return e};b.prototype.setVisibilityFlag=function(a,b,c){void 0===c&&(c=0);var d=this.isVisible(c);this._visibilityFlags[c][a]=b;var e=this.isVisible(c);if(d!==e){if(1===c)this.forEachLabelGraphic(function(a){return a.setVisibility(e)});else{this.forEachSymbolLayerGraphic(function(a){return a.setVisibility(e)});var f=this.isVisible(1);this.forEachLabelGraphic(function(a){return a.setVisibility(f)})}return!0}return!1};b.prototype.getBSRadius=function(){var a=
0;this.forEachSymbolLayerGraphic(function(b){a=Math.max(a,b.getBSRadius())});return a};b.prototype.getCenterObjectSpace=function(){return this._graphics[0].getCenterObjectSpace()};b.prototype.getProjectedBoundingBox=function(a,b,c,d){return m(this,void 0,void 0,function(){var e=this;return g(this,function(q){switch(q.label){case 0:return d||(d={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),d.boundingBox?f.set(d.boundingBox,f.NEGATIVE_INFINITY):d.boundingBox=f.create(f.NEGATIVE_INFINITY),
d.requiresDrapedElevation=!1,[4,r.forEach(this._graphics,function(l){return m(e,void 0,void 0,function(){var e,h,k;return g(this,function(g){switch(g.label){case 0:if(!l)return[2];e=l.isDraped()?b:a;h=p.acquire();return[4,l.getProjectedBoundingBox(e,c,h,d.screenSpaceObjects)];case 1:return k=g.sent(),isFinite(k[2])&&isFinite(k[5])||(d.requiresDrapedElevation=!0),k&&f.expand(d.boundingBox,h),p.release(h),[2]}})})})];case 1:return q.sent(),f.allFinite(d.boundingBox)||n.allFinite(f.toRect(d.boundingBox,
v))?[2,d]:[2,null]}})})};b.prototype.needsElevationUpdates=function(){for(var a=0,b=this._graphics;a<b.length;a++){var c=b[a];if(c&&c.needsElevationUpdates)return!0}a=0;for(b=this._labelGraphics;a<b.length;a++)if((c=b[a])&&c.needsElevationUpdates)return!0;return!1};b.prototype.alignWithElevation=function(a,b){var c=this;this.forEachRenderedGraphic(function(d){d.alignWithElevation(a,b,c._featureExpressionFeature)})};b.prototype.addHighlight=function(a,b){this.forEachSymbolLayerGraphic(function(c){return c.addHighlight(a,
b)})};b.prototype.removeHighlight=function(a){this.forEachSymbolLayerGraphic(function(b){return b.removeHighlight(a)})};b.prototype.forEachGraphicList=function(a,b){a.forEach(function(a,d){return a&&b(a,d)})};b.prototype.forEachSymbolLayerGraphic=function(a){this.forEachGraphicList(this._graphics,a);this.forEachGraphicList(this._auxiliaryGraphics,a)};b.prototype.forEachLabelGraphic=function(a){this.forEachGraphicList(this._labelGraphics,a)};b.prototype.forEachRenderedGraphic=function(a){this.forEachSymbolLayerGraphic(a);
this.forEachLabelGraphic(a)};return b}()});