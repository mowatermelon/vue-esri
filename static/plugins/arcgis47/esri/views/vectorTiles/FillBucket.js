// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.7/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/extendsHelper ../../core/tsSupport/decorateHelper ../../core/ArrayPool ../../core/libs/earcut/earcut ../2d/engine/webgl/Geometry ./Bucket".split(" "),function(E,F,B,G,z,C,x,D){return function(A){function c(a,b,g,e,r,d){b=A.call(this,a,b)||this;if(a.hasDataDrivenFill!==g.isDataDriven())throw Error("incompatible fill buffer");if(a.hasDataDrivenOutline!==r.isDataDriven())throw Error("incompatible outline buffer");b._fillVertexBuffer=g;b._fillIndexBuffer=e;
b._outlineVertexBuffer=r;b._outlineIndexBuffer=d;return b}B(c,A);Object.defineProperty(c.prototype,"fillIndexStart",{get:function(){return this._fillIndexStart},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"fillIndexCount",{get:function(){return this._fillIndexCount},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"outlineIndexStart",{get:function(){return this._outlineIndexStart},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"outlineIndexCount",
{get:function(){return this._outlineIndexCount},enumerable:!0,configurable:!0});c.prototype.assignBufferInfo=function(a){a._fillIndexStart=this._fillIndexStart;a._fillIndexCount=this._fillIndexCount;a.layer.getPaintProperty("fill-outline-color")?(a._outlineIndexStart=this._outlineIndexStart,a._outlineIndexCount=this._outlineIndexCount):(a._outlineIndexStart=0,a._outlineIndexCount=0)};c.prototype.processFeatures=function(a,b){this._fillIndexStart=this._fillIndexBuffer.index;this._fillIndexCount=0;
this._outlineIndexStart=this._outlineIndexBuffer.index;this._outlineIndexCount=0;b=this.layer;var g=this.zoom,e=b.hasDataDrivenFill,r=b.hasDataDrivenOutline;a&&a.setExtent(this.layerExtent);for(var d=b.getPaintValue("fill-pattern",g),f=b.getPaintValue("fill-antialias",g)&&void 0===d,p=0,n=this._features;p<n.length;p++){var k=n[p],q=void 0;e&&(q={color:d?[1,1,1,1]:b.getPaintValue("fill-color",g,k),opacity:b.getPaintValue("fill-opacity",g,k)});var l=void 0;r&&(l={color:d?[1,1,1,1]:b.getPaintValue("fill-outline-color",
g,k),opacity:b.getPaintValue("fill-opacity",g,k)});k=k.getGeometry(a);this._processFeature(k,f,q,l)}};c.prototype._processFeature=function(a,b,g,e){if(a){var r=a.length;if(b)for(b=0;b<r;b++)this._processOutline(a[b],e);var d;for(b=0;b<r;b++)e=c._area(a[b]),128<e?(void 0!==d&&this._processFill(a,d,g),d=[b]):-128>e&&void 0!==d&&d.push(b);void 0!==d&&this._processFill(a,d,g)}};c.prototype._processOutline=function(a,b){var g=this._outlineVertexBuffer,e=this._outlineIndexBuffer,r=e.index,d,f,p,n=new x.Point(0,
0),k=new x.Point(0,0),q=new x.Point(0,0),l=-1,h=-1,m=-1,c=-1,w=-1,y=!1,t=a.length;if(!(2>t)){var v=a[0];for(d=a[t-1];t&&d.isEqual(v);)--t,d=a[t-1];if(!(2>t-0)){for(v=0;v<t;++v){0===v?(d=a[t-1],f=a[0],p=a[1],n.assignSub(f,d),n.normalize(),n.rightPerpendicular()):(d=f,f=p,p=v!==t-1?a[v+1]:a[0],n.assign(k));d=this._isClipEdge(d,f);-1===c&&(y=d);k.assignSub(p,f);k.normalize();k.rightPerpendicular();m=n.x*k.y-n.y*k.x;q.assignAdd(n,k);q.normalize();var u=-q.x*-n.x+-q.y*-n.y,u=Math.abs(0!==u?1/u:1);8<u&&
(u=8);0<=m?(m=g.add(f.x,f.y,n.x,n.y,0,1,b),-1===c&&(c=m),0<=l&&0<=h&&0<=m&&!d&&e.add(l,h,m),h=g.add(f.x,f.y,u*-q.x,u*-q.y,0,-1,b),-1===w&&(w=h),0<=l&&0<=h&&0<=m&&!d&&e.add(l,h,m),l=h,h=m,m=g.add(f.x,f.y,q.x,q.y,0,1,b),0<=l&&0<=h&&0<=m&&!d&&e.add(l,h,m),h=g.add(f.x,f.y,k.x,k.y,0,1,b)):(m=g.add(f.x,f.y,u*q.x,u*q.y,0,1,b),-1===c&&(c=m),0<=l&&0<=h&&0<=m&&!d&&e.add(l,h,m),h=g.add(f.x,f.y,-n.x,-n.y,0,-1,b),-1===w&&(w=h),0<=l&&0<=h&&0<=m&&!d&&e.add(l,h,m),l=h,h=m,m=g.add(f.x,f.y,-q.x,-q.y,0,-1,b),0<=l&&
0<=h&&0<=m&&!d&&e.add(l,h,m),l=g.add(f.x,f.y,-k.x,-k.y,0,-1,b));0<=l&&0<=h&&0<=m&&!d&&e.add(l,h,m)}0<=l&&0<=h&&0<=c&&!y&&e.add(l,h,c);0<=l&&0<=c&&0<=w&&!y&&e.add(l,w,c);this._outlineIndexCount+=3*(e.index-r)}}};c.prototype._processFill=function(a,b,g){var e;1<b.length&&(e=[]);for(var c=0,d=0;d<b.length;d++){var f=b[d];0!==c&&e.push(c);c+=a[f].length}for(var d=2*c,c=z.acquire(),p=0;p<b.length;p++)for(var f=b[p],f=a[f],n=f.length,k=0;k<n;++k)c.push(f[k].x),c.push(f[k].y);a=C(c,e,2);b=a.length;if(0<
b){e=this._fillVertexBuffer.index;for(p=0;p<d;)this._fillVertexBuffer.add(c[p++],c[p++],g);for(g=0;g<b;)this._fillIndexBuffer.add(e+a[g++],e+a[g++],e+a[g++]);this._fillIndexCount+=b}z.release(c)};c.prototype._isClipEdge=function(a,b){return a.x===b.x?-64>=a.x||4160<=a.x:a.y===b.y?-64>=a.y||4160<=a.y:!1};c._area=function(a){for(var b=0,c=a.length-1,e=0;e<c;e++)b+=(a[e].x-a[e+1].x)*(a[e].y+a[e+1].y);b+=(a[c].x-a[0].x)*(a[c].y+a[0].y);return.5*b};return c}(D)});